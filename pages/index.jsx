import Head from "next/head";
import styles from "../styles/Home.module.css";
import { useEffect } from "react";
import ArticleCard from "../components/ArticleCard";
import Timeago from "react-timeago";
import { prisma } from "../lib/prisma";

export const getServerSideProps = async () => {
  const articles = await prisma.articles.findMany({
    orderBy: [
      {
        date: "desc"
      }
    ]
  });
  return {
    props: {
      initialArticles: articles
    }
  };
};

export default function Home({ setHeader, initialArticles, setNavbar }) {
  const parsedArticleCards = initialArticles.map((article) => {
    return (
      <ArticleCard
        key={article.id}
        articleId={article.id}
        title={article.title}
        body={article.body.slice(0, 100) + "..."}
        date={<Timeago date={article.date} />}
        image={article.image}
      />
    );
  });

  useEffect(() => {
    setHeader({ header: "NEWS FEED", hidden: false });
    setNavbar({ navbar: "", hidden: false });
  }, []);

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="articles">{parsedArticleCards}</div>
      <style jsx>{`
        .articles {
          padding-bottom: 4rem;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
      `}</style>
    </div>
  );
}
